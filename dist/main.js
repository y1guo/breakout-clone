(()=>{"use strict";class t{#t;#e;#i;#s;#h;#n;constructor(){this.#t={x:0,y:0},this.#e={x:0,y:0},this.#i={x:0,y:0},this.#s=0,this.#h={x:0,y:0},this.#n=0}setPosition(t,e){this.#t.x=t+this.#e.x/2,this.#t.y=e+this.#e.y/2}setSize(t,e){this.#e.x=t,this.#e.y=e,this.setCollisionSize(t,e)}setCollisionSize(t,e){this.#i.x=t,this.#i.y=e}setAngle(t){this.#s=t}setVelocity(t,e){this.#h.x=t,this.#h.y=e}setAngularVelocity(t){this.#n=t}setCenter(t,e){this.#t.x=t,this.#t.y=e}displace(t,e){this.#t.x+=t,this.#t.y+=e}autoMove(t){let e=this.#h.x*t,i=this.#h.y*t,s=this.#n*t;this.displace(e,i),this.rotate(s)}rotate(t){this.#s+=t}position(){return{x:this.#t.x-this.#e.x/2,y:this.#t.y-this.#e.y/2}}center(){return this.#t}edge(){return{left:this.#t.x-this.#e.x/2,right:this.#t.x+this.#e.x/2,top:this.#t.y-this.#e.y/2,bottom:this.#t.y+this.#e.y/2}}collisionEdge(){return{left:this.#t.x-this.#i.x/2,right:this.#t.x+this.#i.x/2,top:this.#t.y-this.#i.y/2,bottom:this.#t.y+this.#i.y/2}}width(){return this.#e.x}height(){return this.#e.y}collisionSize(){return this.#i}angle(){return this.#s}velocity(){return this.#h}angularVelocity(){return this.#n}}class e extends t{constructor(t){super(),this.gamePanel=t,this.maxSpeed=t.game.settings.paddleMaxSpeed}setVelocityAngle(t){t*=Math.PI/180;let e=this.maxSpeed*Math.cos(t),i=-this.maxSpeed*Math.sin(t);this.setVelocity(e,i)}stop(){this.setVelocity(0,0)}update(t){this.autoMove(t);let e=this.gamePanel.edge();this.edge().left<e.left?this.setPosition(e.left,this.position().y):this.edge().right>e.right&&this.setPosition(e.right-this.width(),this.position().y)}draw(){let t=this.gamePanel.game.ctx;t.fillStyle="#fce",t.fillRect(this.position().x,this.position().y,this.width(),this.height())}}class i{constructor(t){this.game=t,this.keyInput=new s(t),document.addEventListener("keydown",(t=>{this.keyInput.keyDown(t.key)})),document.addEventListener("keyup",(t=>{this.keyInput.keyUp(t.key)}))}}class s{constructor(t){this.game=t,this.keyHeld=[],this.conflictingKeys=[["ArrowLeft","ArrowRight"],["ArrowUp","ArrowDown"]],this.equivalentKeys={a:"ArrowLeft",d:"ArrowRight",w:"ArrowUp",s:"ArrowDown"}}keyDown(t){this.keyHeld=this.keyHeld.filter((e=>e!=t)),this.keyHeld.push(t),this.keyAction()}keyUp(t){this.keyHeld.includes(t)||console.log("Error: keyHeld does not have keys that're pressed!"),this.keyHeld.splice(this.keyHeld.indexOf(t),1),this.keyAction()}keyAction(){switch(this.keyHeld[this.keyHeld.length-1]){case" ":this.game.newGame();break;case"Esc":this.game.togglePaused()}let t=this.game.gamePanel.paddle,e=this.activeConflictingKeys();e.includes("ArrowLeft")?e.includes("ArrowUp")?t.setVelocityAngle(135):e.includes("ArrowDown")?t.setVelocityAngle(-135):t.setVelocityAngle(180):e.includes("ArrowRight")?e.includes("ArrowUp")?t.setVelocityAngle(45):e.includes("ArrowDown")?t.setVelocityAngle(-45):t.setVelocityAngle(0):e.includes("ArrowUp")?t.setVelocityAngle(90):e.includes("ArrowDown")?t.setVelocityAngle(-90):t.stop()}activeConflictingKeys(){let t=[],e=[...this.keyHeld],i=Array(this.conflictingKeys.length).fill(!1);for(;e.length>0;){let s=e.pop();s in this.equivalentKeys&&(s=this.equivalentKeys[s]);for(let e=0;e<this.conflictingKeys.length;e++)if(!i[e]&&this.conflictingKeys[e].includes(s)){i[e]=!0,t.push(s);break}}return t}}function h(t,e){let i=t.collisionEdge(),s=e.collisionEdge();return Math.max(i.top,s.top)<Math.min(i.bottom,s.bottom)&&Math.max(i.left,s.left)<Math.min(i.right,s.right)}class n extends t{constructor(t){super(),this.image=document.getElementById("img-ball"),this.gamePanel=t,this.friction=5e-4,this.gravity=3e-4,this.bounceLoss=.1}update(t){this.autoMove(t);let e=this.velocity();e.x*=1-this.friction,e.y*=1-this.friction,e.y+=this.gravity*t,this.setVelocity(e.x,e.y);let i=this.center(),s=this.gamePanel.edge();e=this.velocity(),i.x<s.left&&(this.setCenter(2*s.left-i.x,i.y),this.setVelocity(-e.x*(1-this.bounceLoss),e.y)),i.x>s.right&&(this.setCenter(2*s.right-i.x,i.y),this.setVelocity(-e.x*(1-this.bounceLoss),e.y)),i.y<s.top&&(this.setCenter(i.x,2*s.top-i.y),this.setVelocity(e.x,-e.y*(1-this.bounceLoss)));let n=this.angularVelocity(),l=this.gamePanel.paddle;i=this.center(),e=this.velocity(),h(this,l)&&(this.setCenter(i.x,2*l.edge().top-i.y),this.setVelocity(e.x+.4*l.velocity().x,(-e.y+1.5*l.velocity().y)*(1-this.bounceLoss)),n+=(e.x-l.velocity().x)/(this.width()/2),this.setAngularVelocity(n))}draw(){let t=this.gamePanel.game.ctx;t.translate(this.center().x,this.center().y),t.rotate(this.angle()),t.drawImage(this.image,-this.width()/2,-this.height()/2,this.width(),this.height()),t.rotate(-this.angle()),t.translate(-this.center().x,-this.center().y)}}class l extends t{constructor(t,e,i){super(),this.gamePanel=t,this.setSize(e.x,e.y),this.setPosition(i.x,i.y),this.markedForDeletion=!1,this.color="#f";for(let t=0;t<2;t++)this.color+=Math.floor(8+6*Math.random()).toString(16)}update(){if(h(this.gamePanel.ball,this)){this.markedForDeletion=!0;let t=this.gamePanel.ball.velocity();this.gamePanel.ball.setVelocity(t.x,-t.y)}}draw(){let t=this.gamePanel.game.ctx;t.fillStyle=this.color,t.fillRect(this.position().x,this.position().y,this.width(),this.height())}}class o extends t{constructor(t){super(),this.game=t}draw(){let t=this.game.ctx;t.fillStyle="#222",t.fillRect(this.position().x,this.position().y,this.width(),this.height()),t.font=.05*this.height()+"px Serif",t.fillStyle="#fff",t.textAlign="center",t.fillText("PRESS SPACE TO START",this.center().x,this.center().y)}}class a extends t{constructor(t){super(),this.game=t}draw(){let t=this.game.ctx;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(this.position().x,this.position().y,this.width(),this.height()),t.font=.1*this.height()+"px Serif",t.fillStyle="#fff",t.textAlign="center",t.fillText("PAUSED",this.center().x,this.center().y)}}class r extends t{constructor(t){super(),this.game=t}draw(){let t=this.game.ctx;t.fillStyle="rgba(240, 192, 224, 0.5)",t.fillRect(this.position().x,this.position().y,this.width(),this.height()),t.font=.1*this.height()+"px Serif",t.fillStyle="#fff",t.textAlign="center",t.fillText("VICTORY",this.center().x,this.center().y)}}class c extends t{constructor(t){super(),this.game=t}draw(){let t=this.game.ctx;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(this.position().x,this.position().y,this.width(),this.height()),t.font=.1*this.height()+"px Serif",t.fillStyle="#fff",t.textAlign="center",t.fillText("GAMEOVER",this.center().x,this.center().y)}}class g extends t{constructor(t){super(),this.game=t}draw(){let t=this.game.ctx;t.fillStyle="#fff",t.fillRect(this.position().x,this.position().y,this.width(),this.height())}}class d extends t{constructor(t){super(),this.game=t}init(){let t=this.game.settings;this.paddle=new e(this),this.ball=new n(this),this.paddle.setSize(t.paddleWidth,t.paddleHeight),this.paddle.setCenter(this.center().x,this.edge().bottom-.02*this.height()-this.paddle.height()),this.ball.setSize(t.ballSize,t.ballSize),this.ball.setCollisionSize(1,1),this.ball.setCenter(this.paddle.center().x+1,this.paddle.edge().top),this.ball.setVelocity(0,0),this.bricks=function(t){let e=[],i=t.game.settings,s=i.brickNumRowMin,h=i.brickNumRowMax,n=i.brickNumCol,o=t.width()/n,a=o/2,r=s+Math.random()*(h-s);for(let i=0;i<r;i++)for(let s=0;s<n;s++)if(Math.random()<.7){let h={x:o,y:a},n={x:t.position().x+o*s,y:t.position().y+a*i};e.push(new l(t,h,n))}return e}(this),this.gameObjects=[...this.bricks,this.paddle,this.ball]}update(t){this.gameObjects.forEach((e=>{e.update(t)})),this.gameObjects=this.gameObjects.filter((t=>!t.markedForDeletion))}draw(){let t=this.game.ctx;t.fillStyle="#fff",t.fillRect(this.position().x,this.position().y,this.width(),this.height()),this.gameObjects.forEach((t=>{t.draw()}))}}let y=document.getElementById("canvas").getContext("2d"),m=new class extends t{constructor(t){super(),this.ctx=t,this.ctx.canvas.width=window.innerWidth,this.ctx.canvas.height=window.innerHeight,this.setCenter(window.innerWidth/2,window.innerHeight/2);let e=Math.min(window.innerWidth,window.innerHeight);this.setSize(e,e),this.titleScreen=new o(this),this.pauseScreen=new a(this),this.victoryScreen=new r(this),this.gameOverScreen=new c(this),this.titleScreen.setSize(this.width(),this.height()),this.pauseScreen.setSize(this.width(),this.height()),this.victoryScreen.setSize(this.width(),this.height()),this.gameOverScreen.setSize(this.width(),this.height()),this.titleScreen.setCenter(this.center().x,this.center().y),this.pauseScreen.setCenter(this.center().x,this.center().y),this.victoryScreen.setCenter(this.center().x,this.center().y),this.gameOverScreen.setCenter(this.center().x,this.center().y),this.infoPanel=new g(this),this.gamePanel=new d(this);let s=.02*e;this.infoPanel.setSize(this.width()-2*s,.15*this.height()-1.5*s),this.infoPanel.setPosition(this.position().x+s,this.position().y+s),this.gamePanel.setSize(this.width()-2*s,this.height()-this.infoPanel.height()-3*s),this.gamePanel.setPosition(this.position().x+s,this.infoPanel.edge().bottom+s),this.settings={paddleWidth:.25*this.gamePanel.width(),paddleHeight:.025*this.gamePanel.width(),paddleMaxSpeed:this.gamePanel.width()/2e3,ballSize:.08*this.gamePanel.width(),brickNumRowMin:4,brickNumRowMax:10,brickNumCol:10},this.gameState=2,new i(this)}newGame(){2!==this.gameState&&3!==this.gameState&&4!==this.gameState||(this.gameState=1,this.gamePanel.init())}update(t){1===this.gameState&&(this.gamePanel.update(t),2===this.gamePanel.gameObjects.length&&(this.gameState=4),this.gamePanel.ball.edge().top>this.gamePanel.edge().bottom&&(this.gameState=3))}draw(){this.ctx.clearRect(0,0,window.innerWidth,window.innerHeight),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,window.innerWidth,window.innerHeight),2===this.gameState&&this.titleScreen.draw(),1===this.gameState&&(this.infoPanel.draw(),this.gamePanel.draw()),0===this.gameState&&(this.infoPanel.draw(),this.gamePanel.draw(),this.pauseScreen.draw()),3===this.gameState&&(this.infoPanel.draw(),this.gamePanel.draw(),this.gameOverScreen.draw()),4===this.gameState&&(this.infoPanel.draw(),this.gamePanel.draw(),this.victoryScreen.draw())}togglePaused(){1===this.gameState?this.gameState=0:0===this.gameState&&(this.gameState=1)}}(y),x=0;requestAnimationFrame((function t(e){let i=e-x;x=e,m.update(i),m.draw(),requestAnimationFrame(t)}))})();